import React, { Component } from 'react';
import PropTypes from 'prop-types';
import unionClassNames from 'union-class-names';
import EditorUtils from 'draft-js-plugins-utils';
import AddLinkForm from './AddLinkForm';

/**
 * Add link form class.
 * @class LinkButton
 * @extends Component
 */
export default class LinkButton extends Component {
  static propTypes = {
    placeholder: PropTypes.string,
    store: PropTypes.shape({}).isRequired,
    theme: PropTypes.shape({}).isRequired,
    ownTheme: PropTypes.shape({}).isRequired,
    onRemoveLinkAtSelection: PropTypes.func.isRequired,
    onOverrideContent: PropTypes.func.isRequired,
  };

  static defaultProps = {
    placeholder: '',
  };

  onMouseDown = event => {
    event.preventDefault();
  };

  onAddLinkClick = e => {
    e.preventDefault();
    e.stopPropagation();
    const { ownTheme, placeholder, onOverrideContent } = this.props;
    const content = props => (
      <AddLinkForm {...props} placeholder={placeholder} theme={ownTheme} />
    );
    onOverrideContent(content);
  };

  /**
   * Render method.
   * @method render
   * @returns {string} Markup for the component.
   */
  render() {
    const { theme, onRemoveLinkAtSelection } = this.props;
    const hasLinkSelected = EditorUtils.hasEntity(
      this.props.store.getEditorState(),
      'LINK',
    );
    const className = hasLinkSelected
      ? unionClassNames(theme.button, theme.active)
      : theme.button;

    return (
      <div
        className={theme.buttonWrapper}
        onMouseDown={this.onMouseDown}
        role="presentation"
      >
        <button
          className={className}
          onClick={
            hasLinkSelected ? onRemoveLinkAtSelection : this.onAddLinkClick
          }
          type="button"
        >
          {!hasLinkSelected ? (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 36 36"
            >
              <g fillRule="evenodd">
                <path d="M27.1318,7.333 C24.4028,4.604 19.9618,4.604 17.2328,7.333 L12.9898,11.576 C11.8428,12.723 11.1288,14.248 10.9778,15.871 C10.8228,17.541 11.2708,19.211 12.2378,20.576 C12.4818,20.919 12.7278,21.213 12.9888,21.475 C13.7848,22.271 14.7778,22.868 15.8608,23.202 C16.5498,23.415 17.2548,23.519 17.9518,23.518 C19.7808,23.518 21.5598,22.804 22.8888,21.475 L23.9498,20.414 L22.5358,19 L21.4748,20.061 C20.1648,21.371 18.2388,21.842 16.4498,21.291 C15.6668,21.049 14.9778,20.635 14.4038,20.061 C14.2218,19.879 14.0478,19.668 13.8698,19.418 C13.1778,18.443 12.8588,17.249 12.9688,16.056 C13.0768,14.896 13.5868,13.808 14.4038,12.99 L18.6468,8.747 C20.5958,6.798 23.7688,6.798 25.7178,8.747 C26.6568,9.687 27.1748,10.942 27.1748,12.283 C27.1748,13.623 26.6568,14.878 25.7178,15.818 L27.1318,17.232 C28.4488,15.915 29.1748,14.157 29.1748,12.283 C29.1748,10.408 28.4488,8.65 27.1318,7.333" />
                <path d="M25.0107,16.5254 C24.2147,15.7294 23.2217,15.1324 22.1387,14.7984 C19.6417,14.0284 16.9477,14.6894 15.1107,16.5254 L14.0507,17.5864 L15.4647,19.0004 L16.5247,17.9394 C17.8357,16.6294 19.7587,16.1554 21.5497,16.7094 C22.3337,16.9514 23.0217,17.3644 23.5957,17.9394 C23.7777,18.1214 23.9527,18.3314 24.1307,18.5824 C24.8217,19.5564 25.1417,20.7514 25.0317,21.9444 C24.9237,23.1034 24.4137,24.1924 23.5957,25.0104 L19.3537,29.2534 C17.4047,31.2024 14.2317,31.2024 12.2817,29.2534 C11.3427,28.3134 10.8247,27.0574 10.8247,25.7174 C10.8247,24.3774 11.3427,23.1214 12.2817,22.1824 L10.8677,20.7684 C9.5507,22.0854 8.8247,23.8424 8.8247,25.7174 C8.8247,27.5924 9.5507,29.3504 10.8677,30.6674 C12.2327,32.0314 14.0257,32.7134 15.8177,32.7134 C17.6107,32.7134 19.4027,32.0314 20.7677,30.6674 L25.0107,26.4244 C26.1567,25.2774 26.8717,23.7524 27.0227,22.1294 C27.1777,20.4594 26.7297,18.7894 25.7617,17.4244 C25.5177,17.0814 25.2717,16.7874 25.0107,16.5254" />
              </g>
            </svg>
          ) : (
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 36 36"
            >
              <g fillRule="evenodd">
                <path d="M21.0107,16.8418 C20.2147,16.0458 19.2217,15.4488 18.1387,15.1148 C15.6417,14.3438 12.9477,15.0058 11.1107,16.8418 L10.0507,17.9028 L11.4647,19.3168 L12.5247,18.2558 C13.8347,16.9448 15.7587,16.4718 17.5497,17.0258 C18.3337,17.2678 19.0217,17.6808 19.5957,18.2558 C19.7777,18.4378 19.9527,18.6478 20.1307,18.8988 C20.8217,19.8728 21.1417,21.0678 21.0317,22.2608 C20.9237,23.4198 20.4137,24.5088 19.5957,25.3268 L15.3537,29.5698 C13.4047,31.5188 10.2317,31.5188 8.2817,29.5698 C7.3427,28.6298 6.8247,27.3738 6.8247,26.0338 C6.8247,24.6938 7.3427,23.4378 8.2817,22.4988 L6.8677,21.0848 C5.5507,22.4018 4.8247,24.1588 4.8247,26.0338 C4.8247,27.9088 5.5507,29.6668 6.8677,30.9838 C8.2327,32.3478 10.0257,33.0298 11.8177,33.0298 C13.6107,33.0298 15.4027,32.3478 16.7677,30.9838 L21.0107,26.7408 C22.1567,25.5938 22.8717,24.0688 23.0227,22.4458 C23.1777,20.7758 22.7297,19.1058 21.7617,17.7408 C21.5177,17.3978 21.2717,17.1038 21.0107,16.8418" />
                <path d="M10.1343,22.0127 C10.4893,22.2367 10.8293,22.4137 11.1733,22.5567 C12.0123,22.9047 12.9223,23.0837 13.8363,23.0837 C14.0523,23.0837 14.2703,23.0737 14.4863,23.0537 C16.3673,22.8777 18.1243,21.9367 19.3063,20.4717 L17.7493,19.2167 C16.9053,20.2627 15.6473,20.9357 14.3003,21.0617 C13.4823,21.1387 12.6873,21.0197 11.9393,20.7087 C11.7003,20.6107 11.4583,20.4827 11.1983,20.3197 C10.1863,19.6837 9.4343,18.7027 9.0803,17.5577 C8.7363,16.4457 8.7893,15.2447 9.2323,14.1767 L11.5283,8.6327 C12.5833,6.0857 15.5133,4.8707 18.0613,5.9267 L18.8263,4.0787 C15.2603,2.6027 11.1583,4.3027 9.6803,7.8667 L7.3843,13.4107 C6.7633,14.9087 6.6873,16.5927 7.1693,18.1487 C7.6653,19.7507 8.7183,21.1227 10.1343,22.0127" />
                <polygon points="25 15.316 31 15.316 31 13.316 25 13.316" />
                <polygon points="24.949 3.633 23.052 3 21.052 9 22.949 9.633" />
                <polygon points="31.581 7.13 30.419 5.502 23.419 10.502 24.581 12.13" />
                <polygon points="24.553 18.211 28.553 20.211 29.448 18.422 25.448 16.422" />
              </g>
            </svg>
          )}
        </button>
      </div>
    );
  }
}
